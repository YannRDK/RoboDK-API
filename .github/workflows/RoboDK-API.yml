name: RoboDK-API

on: 
  pull_request:
  push:
  workflow_dispatch: # Run workflow manually
    branches: [master]
    paths:
      - "Python/robodk/*.py"

env:
  BUILD_TYPE: Release

jobs:

  # This job runs the tests in the RoboDK docker image.
  test_robodk:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: true
      matrix:
        os: [ubuntu-latest]
        python-version: ["3.10"]    #["3.7", "3.8", "3.9", "3.10", "3.11"]
    container: 
      image: robodk/robodk:latest
      credentials:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_TOKEN }}  
      options: --user root
      ports:
        - 20501:20501
      volumes:
        - ${{ github.workspace }}:/Python/tests

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Run Tests
        run: |
          cd /Python/tests
          nose2 --config nose2.cfg -v

      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: TestResults
          path: |
           /Python/tests/results.xml
           /Python/tests/report.html